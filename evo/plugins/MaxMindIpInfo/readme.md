# Плагин для ModX Evolution. Собирает информацию об IP адресе пользователя.

Плагин собирает информацию об IP пользователя сайта для дальнейшего использования.<br>
Он ничего не делает, просто собирает инфу и сохраняет их в сессии и в куках (на 10 дней, что можно поменять в коде)<br>
Работает на бесплатной версии от https://www.maxmind.com/, что на сегодняшний день является наиболее актуальной базой IP-адресов.<br>
Было такое на NIC.RU но они чот забыли об этом. Остальные базы все платные. Бесплатных не нашел.<br>
Но и тут есть ограничения, но не такие как везде. Вам достаточно скачать файлы баз и ВЕЛКАМ!<br>
Одно НО! Лицензия подразумевает некоммерческое использование!<br>
Если иное, то пишите на адрес redcat@nxt.ru я всегда рад помочь!<br>
Иное - на ваше усмотрение!<br>
Вы ведь ознакомились с лицензией? <br>
**Лицензия https://creativecommons.org/licenses/by-sa/4.0/ Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)**<br>
Да! По лицензии от https://www.maxmind.com/ вы должны указать ссылку на сайте такого типа:<br>
This product includes GeoLite2 data created by MaxMind, available from <a href="https://www.maxmind.com">https://www.maxmind.com</a>.<br>
Это на ваше усмотрение.

# ВНИМАНИЕ!!!!! ПЛАГИН НЕ РАБОТАЕТ НА ЛОКАЛЬНЫХ IP АДРЕСАХ!!!!

Т.к. локальные адреса не индексируются.

# ОПИСАНИЕ

Плагин берет 2 основных параметра информации об IP.
Это, если есть **$_SERVER['HTTP_X_FORWARDED_FOR']** или если его нет, то **$_SERVER['REMOTE_ADDR']** 
Если уж и его нет, то всегда что-то да есть)

Сохраняет в сессии и в куках данные об IP адресе пользователя сайта для дальнейшего использования где бы то ни было.

## Установка

1. Вы можете установить данный плагин посредством стандартного уставщика ModX Evolution
2. Вы можете загрузить пакет установки, он тут

## Настройка

У плагина есть только 1 настройка. Это выводить все данные или только если нужен город, или только страна, или ASN (инфа о провайдере)
По умолчанию - ВСЕ

## Как посмотреть результат работы плагина?

>> Плагин выполняется на событии OnBeforeLoadDocumentObject<br>

Я просто не нашел события которое раньше, это в упрек разработчикам, т.к. могут и другие события происходить, что возможно происходят ранее.

Результат работы плагина сохраняется в сессии и в куках, чтоб не юзать лишний раз базу.
Вы всегда можете установить плагин и потом написать небольшой сниппет для вывода данных, что он собрал.
Мне лень писать отдельно, т.к. для каждого случая бывают разная необходимость в этом плагине.
Вы можете просто написать сниппет и вызвать его на любой странице или иное.

>> небольшой пример сниппета, что выводит все данные собранные плагином, назовем его test (или как пожелаете) <br>

```php
<?php 
echo '<pre>';
print_r($_SESSION['MaxMindIpInfo']);
echo '</pre>';
?>
```

Т.к. я нахожусь в Уфе, Россия, данный скрипт выведет такое:
```html
Array
(
    [city] => Array
        (
            [geoname_id] => 479561
            [names] => Array
                (
                    [de] => Ufa
                    [en] => Ufa
                    [es] => Ufá
                    [fr] => Oufa
                    [ja] => ウファ
                    [pt-BR] => Ufa
                    [ru] => Уфа
                )

        )

    [continent] => Array
        (
            [code] => EU
            [geoname_id] => 6255148
            [names] => Array
                (
                    [de] => Europa
                    [en] => Europe
                    [es] => Europa
                    [fr] => Europe
                    [ja] => ヨーロッパ
                    [pt-BR] => Europa
                    [ru] => Европа
                    [zh-CN] => 欧洲
                )

        )

    [country] => Array
        (
            [geoname_id] => 2017370
            [iso_code] => RU
            [names] => Array
                (
                    [de] => Russland
                    [en] => Russia
                    [es] => Rusia
                    [fr] => Russie
                    [ja] => ロシア
                    [pt-BR] => Rússia
                    [ru] => Россия
                    [zh-CN] => 俄罗斯
                )

        )

    [location] => Array
        (
            [accuracy_radius] => 5
            [latitude] => 54.8
            [longitude] => 55.9
            [time_zone] => Asia/Yekaterinburg
        )

    [postal] => Array
        (
            [code] => 450511
        )

    [registered_country] => Array
        (
            [geoname_id] => 2017370
            [iso_code] => RU
            [names] => Array
                (
                    [de] => Russland
                    [en] => Russia
                    [es] => Rusia
                    [fr] => Russie
                    [ja] => ロシア
                    [pt-BR] => Rússia
                    [ru] => Россия
                    [zh-CN] => 俄罗斯
                )

        )

    [subdivisions] => Array
        (
            [0] => Array
                (
                    [geoname_id] => 578853
                    [iso_code] => BA
                    [names] => Array
                        (
                            [de] => Baschkortostan
                            [en] => Bashkortostan Republic
                            [fr] => République de Bachkirie
                            [ru] => Башкортостан
                        )

                )

        )

    [autonomous_system_number] => 24955
    [autonomous_system_organization] => OJSC Ufanet
)
```

Почтовый индекс не всегда соответсвует, увы(((


### ПРИМЕЧАНИЕ
ЕСЛИ У ВАС ВКЛЮЧЕН КЭШ НА САЙТЕ, НЕ ГАРАНТИРУЕТСЯ ПРАВИЛЬНАЯ РАБОТА ПЛАГИНА!
Т.К. ЧЕРЕЗ АДМИНКУ СБРАСЫВАЕТСЯ ТОЛЬКО КЭШ ДОКУМЕНТОВ, А НЕ ВЕСЬ - ВАМ НАДО УДАЛЯТЬ ВРУЧНУЮ ВЕСЬ КЭШ ИЗ ПАПКИ "assets/cache"
ЕСЛИ ЧТО НЕ РАБОТАЕТ.... 
Опять же в минус разработчикам!
>> РАЗРАБОТЧИКАМ! Я что-то не нашел как не кэшировать результат выполнения плагинов, если я не прав - напишите на адрес redcat@nxt.ru

### ПОЛЬЗОВАТЕЛЯМ MODX REVO 

Я также делаю расширения для REVO. Данный плагин не тестировался, но вероятно тоже будет работать, т.к. там нет противоречий.

### ОБРАТНАЯ СВЯЗЬ
Я пока в процессе собирательства. Есть много идей, в том числе реализованных, но они то тут то там.... Был молод, не до этого было.
Если понравился плагин, то всегда пишите благодарности на ящик redcat@nxt.ru
А ещё лучше поддержать меня монетами))) т.к. в плане связать этот определитель IP с ОКАТО и сейчас вот с ОКТМО, т.е. даже до номеру дома будет подставляться.... но, блин времени не хватает и налоговоя там каждые полгода меняет все. Ну не каждые полгода, но заметил вот.... было окато, сейчас внедряют октмо

P.S.<br>
А если очень очень понравилось и таки ждете продолжения, то по желанию пересисляем сколько не жалко на яндекс-кошелек № 410012915061407<br>
Так как в плане сделать то же для опенкарт и для вукоммерс и для джумшоппинг и другое<br>
Пока в плане сделать связку окато/октмо по ip населенного пункта (а есть ещё фиас... правда там тоже самое что октмо/окато), если есть.
